<!DOCTYPE html>
<html lang="id">
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HANN 25 - UPLOAD</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #050505; color: white; padding: 20px; min-height: 100vh; }
        .header-area { text-align: center; margin-bottom: 30px; margin-top: 10px; }
        .header-area h1 { letter-spacing: 2px; margin-bottom: 5px; font-size: 24px; }
        .header-area p { color: #666; font-size: 12px; margin-top: 0; }
        .card { background: #111; border: 1px solid #333; padding: 25px; border-radius: 20px; max-width: 500px; margin: 0 auto 20px auto; }
        h2 { color: #0ea5e9; font-size: 14px; border-bottom: 1px solid #222; padding-bottom: 10px; margin-top: 0; text-transform: uppercase; letter-spacing: 1px; }
        input, textarea, select { width: 100%; padding: 12px; background: #000; border: 1px solid #333; border-radius: 10px; color: white; margin-bottom: 12px; box-sizing: border-box; outline: none; font-family: inherit; font-size: 13px; }
        input:focus { border-color: #0ea5e9; }
        
        .multi-select { position: relative; width: 100%; margin-bottom: 12px; }
        .select-box { 
            padding: 12px; background: #000; border: 1px solid #333; 
            border-radius: 10px; cursor: pointer; font-size: 13px; color: #666;
            display: flex; justify-content: space-between; align-items: center; box-sizing: border-box;
        }
        .select-box.active { border-color: #0ea5e9; color: #fff; }
        .options-container { 
            position: absolute; top: calc(100% + 5px); left: 0; width: 100%; 
            background: #0a0a0a; border: 1px solid #333; border-radius: 10px; 
            display: none; z-index: 100; padding: 10px; box-sizing: border-box;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .options-container.show { display: block; }
        .opt-item { 
            display: flex; align-items: center; gap: 10px; padding: 10px; 
            border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 12px; color: #ccc;
        }
        .opt-item:hover { background: rgba(14, 165, 233, 0.1); color: #fff; }
        .opt-item input { width: auto; margin: 0; cursor: pointer; }

        .btn-blue { width: 100%; padding: 14px; background: #0ea5e9; color: white; border: none; border-radius: 10px; font-weight: 800; cursor: pointer; transition: 0.3s; font-size: 12px; letter-spacing: 1px; }
        .btn-blue:hover { background: #0284c7; transform: translateY(-2px); }
        .item { background: #161616; padding: 15px; border-radius: 12px; border: 1px solid #222; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .item-info b { display: block; font-size: 13px; color: #fff; margin-bottom: 4px; }
        .stats { font-size: 10px; color: #666; font-weight: 600; }
        .btn-red { background: #ff4757; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 10px; font-weight: 800; }
        #main-content { display: none; }
        .pagination { display: flex; justify-content: center; gap: 8px; margin-top: 20px; }
        .page-btn { padding: 8px 14px; background: #111; border: 1px solid #333; color: white; cursor: pointer; border-radius: 8px; font-size: 12px; font-weight: 800; }
        .page-btn.active { background: #0ea5e9; border-color: #0ea5e9; }
    </style>
</head>
<body>

    <div id="main-content">
        <div class="header-area">
            <h1>MANAGER UPLOAD</h1>
            <p>Upload konten tanpa edit kode HTML</p>
        </div>

        <div class="card">
            <h2>üöÄ Upload New File</h2>
            <input type="text" id="dl-title" placeholder="Nama Bot/File">
            <input type="text" id="dl-thumb" placeholder="Link Thumbnail (URL)">
            <input type="text" id="dl-link" placeholder="Link Download">
            <textarea id="dl-desc" placeholder="Deskripsi singkat..." rows="2"></textarea>
            
            <div class="multi-select">
                <div class="select-box" id="cat-trigger" onclick="window.toggleCatDropdown()">
                    <span id="selected-label">Pilih Kategori</span>
                    <span>‚ñº</span>
                </div>
                <div class="options-container" id="cat-options">
                    <label class="opt-item"><input type="checkbox" class="cat-cb" value="bot md"> Bot MD</label>
                    <label class="opt-item"><input type="checkbox" class="cat-cb" value="bot store"> Bot Store</label>
                    <label class="opt-item"><input type="checkbox" class="cat-cb" value="bot bug"> Bot Bug</label>
                    <label class="opt-item"><input type="checkbox" class="cat-cb" value="bot pushkontak"> Bot Pushkontak</label>
                    <label class="opt-item"><input type="checkbox" class="cat-cb" value="bot cpanel"> Bot Cpanel</label>
                </div>
            </div>

            <select id="dl-plat">
                <option value="wa">VIA: WHATSAPP</option>
                <option value="tele:">VIA: TELEGRAM</option>
            </select>
            
            <button class="btn-blue" onclick="window.addFile()">PUBLISH CONTENT</button>
        </div>

        <div class="card">
            <h2>üìÇ Active Files (<span id="count">0</span>)</h2>
            <div id="dl-list"></div>
            <div id="pagination" class="pagination"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, onValue, push, remove, update } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
        import { getRemoteConfig, getValue, fetchAndActivate } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-remote-config.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyBgqJ0f2v88T6Ijamd5gGS-NZzJyVl0pYU", 
            databaseURL: "https://adminhann25-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "adminhann25",
            appId: "1:1020946488981:web:9b2cf0902f5665e342c59c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const rc = getRemoteConfig(app);
        rc.settings.minimumFetchIntervalMillis = 0;

        let allFiles = [];
        let currentPage = 1;
        const itemsPerPage = 10;

        window.toggleCatDropdown = () => {
            document.getElementById('cat-options').classList.toggle('show');
            document.getElementById('cat-trigger').classList.toggle('active');
        };

        document.querySelectorAll('.cat-cb').forEach(cb => {
            cb.addEventListener('change', () => {
                const selected = Array.from(document.querySelectorAll('.cat-cb:checked')).map(c => c.value);
                document.getElementById('selected-label').innerText = selected.length > 0 ? selected.join(', ').toUpperCase() : 'Pilih Kategori';
            });
        });

        window.addEventListener('click', (e) => {
            if (!e.target.closest('.multi-select')) {
                document.getElementById('cat-options').classList.remove('show');
                document.getElementById('cat-trigger').classList.remove('active');
            }
        });

        const checkAccess = async () => {
            if (sessionStorage.getItem("__auth_dl") === "true") {
                document.getElementById("main-content").style.display = "block";
                return;
            }
            try {
                await fetchAndActivate(rc);
                const pass = getValue(rc, "admin_password").asString();
                const { value: res } = await Swal.fire({
                    title: 'ADMIN ACCESS', input: 'password', background: '#111', color: '#fff',
                    allowOutsideClick: false, preConfirm: (v) => {
    const inputHashed = CryptoJS.SHA256(v).toString();
    if (inputHashed === pass) {
        return true;
    } else {
        Swal.showValidationMessage('Password Salah!');
        return false;
    }
}

                if (res) {
                    sessionStorage.setItem("__auth_dl", "true");
                    document.getElementById("main-content").style.display = "block";
                }
            } catch (err) { console.error(err); }
        };

        window.addFile = () => {
            const title = document.getElementById('dl-title').value;
            const thumb = document.getElementById('dl-thumb').value;
            const link = document.getElementById('dl-link').value;
            const desc = document.getElementById('dl-desc').value;
            const plat = document.getElementById('dl-plat').value;
            const selectedCats = Array.from(document.querySelectorAll('.cat-cb:checked')).map(cb => cb.value);
            const catString = selectedCats.join(', ');

            if(!title || !link || !thumb) return Swal.fire("Error", "Isi Title, Thumb, dan Link!", "error");
            if(selectedCats.length === 0) return Swal.fire("Error", "Pilih minimal satu kategori!", "error");

            push(ref(db, 'downloads'), {
                title, thumb, link, desc: desc || '-', 
                category: catString, 
                platform: plat,
                dlCount: 0, likes: 0,
                date: new Date().toLocaleDateString('id-ID', {day:'numeric', month:'short', year:'numeric'}),
                ts: Date.now()
            }).then(() => {
                Swal.fire({ title: "Published!", icon: "success", background: '#111', color: '#fff' });
                document.querySelectorAll('input:not([type="checkbox"]), textarea').forEach(i => i.value = "");
                document.querySelectorAll('.cat-cb').forEach(cb => cb.checked = false);
                document.getElementById('selected-label').innerText = 'Pilih Kategori';
            });
        };

        onValue(ref(db, 'downloads'), (snap) => {
            allFiles = [];
            if(snap.exists()) {
                snap.forEach(c => { allFiles.push({id: c.key, ...c.val()}); });
                allFiles.sort((a,b) => b.ts - a.ts);
            }
            document.getElementById('count').innerText = allFiles.length;
            window.renderList();
        });

        window.renderList = () => {
            const list = document.getElementById('dl-list');
            list.innerHTML = "";
            const start = (currentPage - 1) * itemsPerPage;
            const currentItems = allFiles.slice(start, start + itemsPerPage);
            currentItems.forEach(f => {
                const d = document.createElement('div');
                d.className = 'item';
                const catDisplay = f.category ? String(f.category).toUpperCase() : 'NO CATEGORY';
                d.innerHTML = `<div class="item-info"><b>${f.title}</b><div class="stats">üì• ${f.dlCount || 0} | ‚ù§Ô∏è ${f.likes || 0} | üè∑Ô∏è ${catDisplay}</div></div><button class="btn-red" onclick="window.delFile('${f.id}')">DELETE</button>`;
                list.appendChild(d);
            });
            window.renderPagination();
        };

        window.renderPagination = () => {
            const pg = document.getElementById('pagination');
            pg.innerHTML = "";
            const total = Math.ceil(allFiles.length / itemsPerPage);
            if(total <= 1) return;
            for(let i=1; i<=total; i++) {
                const btn = document.createElement('button');
                btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                btn.innerText = i;
                btn.onclick = () => { currentPage = i; window.renderList(); };
                pg.appendChild(btn);
            }
        };

        window.delFile = (id) => {
            Swal.fire({
                title: 'Delete File?', icon: 'warning', background: '#111', color: '#fff',
                showCancelButton: true, confirmButtonColor: '#ff4757'
            }).then((res) => { if(res.isConfirmed) remove(ref(db, `downloads/${id}`)); });
        };

        checkAccess();
    </script>
</body>
</html>
