<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HANN 25 - UPLOAD MANAGER</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #050505; color: white; padding: 20px; min-height: 100vh; }
        .header-area { text-align: center; margin-bottom: 30px; margin-top: 10px; }
        .header-area h1 { letter-spacing: 2px; margin-bottom: 5px; font-size: 24px; }
        .header-area p { color: #666; font-size: 12px; margin-top: 0; }
        .card { background: #111; border: 1px solid #333; padding: 25px; border-radius: 20px; max-width: 500px; margin: 0 auto 20px auto; }
        h2 { color: #0ea5e9; font-size: 14px; border-bottom: 1px solid #222; padding-bottom: 10px; margin-top: 0; text-transform: uppercase; letter-spacing: 1px; }
        input, textarea, select { width: 100%; padding: 12px; background: #000; border: 1px solid #333; border-radius: 10px; color: white; margin-bottom: 12px; box-sizing: border-box; outline: none; font-family: inherit; font-size: 13px; }
        input:focus { border-color: #0ea5e9; }
        .btn-blue { width: 100%; padding: 14px; background: #0ea5e9; color: white; border: none; border-radius: 10px; font-weight: 800; cursor: pointer; transition: 0.3s; font-size: 12px; letter-spacing: 1px; }
        .btn-blue:hover { background: #0284c7; transform: translateY(-2px); }
        .item { background: #161616; padding: 15px; border-radius: 12px; border: 1px solid #222; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .item-info b { display: block; font-size: 13px; color: #fff; margin-bottom: 4px; }
        .stats { font-size: 10px; color: #666; font-weight: 600; }
        .btn-red { background: #ff4757; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 10px; font-weight: 800; }
        #main-content { display: none; }
        .pagination { display: flex; justify-content: center; gap: 8px; margin-top: 20px; }
        .page-btn { padding: 8px 14px; background: #111; border: 1px solid #333; color: white; cursor: pointer; border-radius: 8px; font-size: 12px; font-weight: 800; }
        .page-btn.active { background: #0ea5e9; border-color: #0ea5e9; }
    </style>
</head>
<body>

    <div id="main-content">
        <div class="header-area">
            <h1>MANAGER UPLOAD</h1>
            <p>Upload konten tanpa edit kode HTML</p>
        </div>

        <div class="card">
            <h2>üöÄ Upload New File</h2>
            <input type="text" id="dl-title" placeholder="Nama Bot/File">
            <input type="text" id="dl-thumb" placeholder="Link Thumbnail (URL)">
            <input type="text" id="dl-link" placeholder="Link Download">
            <textarea id="dl-desc" placeholder="Deskripsi singkat..." rows="2"></textarea>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="dl-cat" placeholder="Kategori (contoh: bot md, bot bug)">
                <select id="dl-plat" style="width: 140px;">
                    <option value="wa">WA</option>
                    <option value="tele">TELE</option>
                </select>
            </div>
            <button class="btn-blue" onclick="window.addFile()">PUBLISH CONTENT</button>
        </div>

        <div class="card">
            <h2>üìÇ Active Files (<span id="count">0</span>)</h2>
            <div id="dl-list"></div>
            <div id="pagination" class="pagination"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, onValue, push, remove, update } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
        import { getRemoteConfig, getValue, fetchAndActivate } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-remote-config.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyBgqJ0f2v88T6Ijamd5gGS-NZzJyVl0pYU", 
            databaseURL: "https://adminhann25-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "adminhann25",
            appId: "1:1020946488981:web:9b2cf0902f5665e342c59c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const rc = getRemoteConfig(app);
        rc.settings.minimumFetchIntervalMillis = 0;

        let allFiles = [];
        let currentPage = 1;
        const itemsPerPage = 10;

        const checkAccess = async () => {
            if (sessionStorage.getItem("__auth_dl") === "true") {
                document.getElementById("main-content").style.display = "block";
                return;
            }
            try {
                await fetchAndActivate(rc);
                const pass = getValue(rc, "admin_password").asString();
                const { value: res } = await Swal.fire({
                    title: 'ADMIN ACCESS', input: 'password', background: '#111', color: '#fff',
                    allowOutsideClick: false, preConfirm: (v) => v === pass || Swal.showValidationMessage('Wrong Password!')
                });
                if (res) {
                    sessionStorage.setItem("__auth_dl", "true");
                    document.getElementById("main-content").style.display = "block";
                }
            } catch (err) { console.error(err); }
        };

        window.addFile = () => {
            const title = document.getElementById('dl-title').value;
            const thumb = document.getElementById('dl-thumb').value;
            const link = document.getElementById('dl-link').value;
            const desc = document.getElementById('dl-desc').value;
            const cat = document.getElementById('dl-cat').value;
            const plat = document.getElementById('dl-plat').value;

            if(!title || !link || !thumb) return Swal.fire("Error", "Isi Title, Thumb, dan Link!", "error");

            push(ref(db, 'downloads'), {
                title, thumb, link, desc: desc || '-', 
                category: cat || 'bot', 
                platform: plat,
                dlCount: 0, likes: 0,
                date: new Date().toLocaleDateString('id-ID', {day:'numeric', month:'short', year:'numeric'}),
                ts: Date.now()
            }).then(() => {
                Swal.fire({ title: "Published!", icon: "success", background: '#111', color: '#fff' });
                document.querySelectorAll('input, textarea').forEach(i => i.value = "");
            });
        };

        onValue(ref(db, 'downloads'), (snap) => {
            allFiles = [];
            if(snap.exists()) {
                snap.forEach(c => { allFiles.push({id: c.key, ...c.val()}); });
                allFiles.sort((a,b) => b.ts - a.ts);
            }
            document.getElementById('count').innerText = allFiles.length;
            window.renderList();
        });

        window.renderList = () => {
            const list = document.getElementById('dl-list');
            list.innerHTML = "";
            const start = (currentPage - 1) * itemsPerPage;
            const currentItems = allFiles.slice(start, start + itemsPerPage);

            currentItems.forEach(f => {
                const d = document.createElement('div');
                d.className = 'item';
                d.innerHTML = `
                    <div class="item-info">
                        <b>${f.title}</b>
                        <div class="stats">üì• ${f.dlCount || 0} | ‚ù§Ô∏è ${f.likes || 0} | üè∑Ô∏è ${f.category}</div>
                    </div>
                    <button class="btn-red" onclick="window.delFile('${f.id}')">DELETE</button>
                `;
                list.appendChild(d);
            });
            window.renderPagination();
        };

        window.renderPagination = () => {
            const pg = document.getElementById('pagination');
            pg.innerHTML = "";
            const total = Math.ceil(allFiles.length / itemsPerPage);
            if(total <= 1) return;
            for(let i=1; i<=total; i++) {
                const btn = document.createElement('button');
                btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                btn.innerText = i;
                btn.onclick = () => { currentPage = i; window.renderList(); };
                pg.appendChild(btn);
            }
        };

        window.delFile = (id) => {
            Swal.fire({
                title: 'Delete File?', icon: 'warning', background: '#111', color: '#fff',
                showCancelButton: true, confirmButtonColor: '#ff4757'
            }).then((res) => { if(res.isConfirmed) remove(ref(db, `downloads/${id}`)); });
        };

        checkAccess();
    </script>
</body>
</html>
